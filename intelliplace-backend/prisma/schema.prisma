generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Student {
  id            Int            @id @default(autoincrement())
  name          String
  email         String         @unique
  password      String
  rollNumber    String?        @map("roll_number")
  cgpa          Float?
  backlog       Int?
  cvUrl         String?        @map("cv_url")
  cvData        Bytes?         @map("cv_data")
  phone         String?
  createdAt     DateTime       @default(now()) @map("created_at")
  updatedAt     DateTime       @updatedAt @map("updated_at")
  applications  Application[]
  notifications Notification[]
  aptitudeSubmissions AptitudeSubmission[]

  @@index([email])
  @@map("students")
}

model Company {
  id          Int      @id @default(autoincrement())
  companyName String   @map("company_name")
  email       String   @unique
  password    String
  industry    String?
  website     String?
  phone       String?
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")
  jobs        Job[]

  @@index([email])
  @@map("companies")
}

model Job {
  id                   Int            @id @default(autoincrement())
  title                String
  description          String
  location             String?
  type                 String
  salary               String?
  requiredSkills       String?        @map("required_skills")
  minCgpa              Float?         @map("min_cgpa")
  includeCgpaInShortlisting Boolean?  @default(true) @map("include_cgpa_in_shortlisting")
  allowBacklog         Boolean?       @map("allow_backlog")
  maxBacklog           Int?           @map("max_backlog")
  jobDescriptionFileUrl String?        @map("job_description_file_url")
  deadline             DateTime?      @map("deadline")
  companyId            Int            @map("company_id")
  status               String         @default("OPEN")
  createdAt            DateTime       @default(now()) @map("created_at")
  updatedAt            DateTime       @updatedAt @map("updated_at")
  applications         Application[]
  interviews           Interview[]
  aptitudeTest         AptitudeTest?
  company              Company        @relation(fields: [companyId], references: [id])
  notifications        Notification[]

  @@index([companyId])
  @@map("jobs")
}

model Application {
  id             Int            @id @default(autoincrement())
  studentId      Int            @map("student_id")
  jobId          Int            @map("job_id")
  skills         String?        @map("skills")
  cgpa           Float?         @map("cgpa")
  backlog        Int?           @map("backlog")
  cvUrl          String?        @map("cv_url")
  cvData         Bytes?         @map("cv_data")
  decisionReason String?        @map("decision_reason")
  status         String         @default("PENDING")
  createdAt      DateTime       @default(now()) @map("created_at")
  updatedAt      DateTime       @updatedAt @map("updated_at")
  job            Job            @relation(fields: [jobId], references: [id])
  student        Student        @relation(fields: [studentId], references: [id])
  interview      Interview?
  notifications  Notification[]

  @@index([studentId])
  @@index([jobId])
  @@map("applications")
}

model Interview {
  id            Int         @id @default(autoincrement())
  applicationId Int         @unique @map("application_id")
  jobId         Int         @map("job_id")
  date          DateTime
  type          String
  status        String      @default("SCHEDULED")
  notes         String?
  createdAt     DateTime    @default(now()) @map("created_at")
  updatedAt     DateTime    @updatedAt @map("updated_at")
  application   Application @relation(fields: [applicationId], references: [id])
  job           Job         @relation(fields: [jobId], references: [id])

  @@index([applicationId])
  @@index([jobId])
  @@map("interviews")
}

model Notification {
  id             Int          @id @default(autoincrement())
  studentId      Int          @map("student_id")
  title          String
  message        String
  read           Boolean      @default(false)
  decisionReason String?      @map("decision_reason")
  jobId          Int?         @map("job_id")
  applicationId  Int?         @map("application_id")
  createdAt      DateTime     @default(now()) @map("created_at")
  updatedAt      DateTime     @updatedAt @map("updated_at")
  application    Application? @relation(fields: [applicationId], references: [id])
  job            Job?         @relation(fields: [jobId], references: [id])
  student        Student      @relation(fields: [studentId], references: [id])

  @@index([studentId])
  @@index([read])
  @@map("notifications")
}

model AptitudeTest {
  id             Int      @id @default(autoincrement())
  jobId          Int      @map("job_id") @unique
  sections       Json
  cutoff         Int?
  totalQuestions Int?
  status         String   @default("CREATED")
  startedAt      DateTime?
  createdAt      DateTime @default(now()) @map("created_at")
  updatedAt      DateTime @updatedAt @map("updated_at")

  job Job @relation(fields: [jobId], references: [id])
  questions AptitudeQuestion[]
  submissions AptitudeSubmission[]

  @@index([jobId])
  @@map("aptitude_tests")
}

model AptitudeQuestion {
  id          Int      @id @default(autoincrement())
  testId      Int      @map("test_id")
  section     String
  questionText String  @map("question_text")
  options     Json
  correctIndex Int    @map("correct_index")
  marks       Int?    @default(1)
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  test AptitudeTest @relation(fields: [testId], references: [id])

  @@index([testId])
  @@map("aptitude_questions")
}

model AptitudeSubmission {
  id          Int      @id @default(autoincrement())
  testId      Int      @map("test_id")
  studentId   Int      @map("student_id")
  answers     Json
  score       Int
  maxScore    Int
  passed      Boolean?
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  test    AptitudeTest @relation(fields: [testId], references: [id])
  student Student      @relation(fields: [studentId], references: [id])

  @@index([testId])
  @@index([studentId])
  @@map("aptitude_submissions")
}

model Admin {
  id        Int      @id @default(autoincrement())
  username  String   @unique
  password  String
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@index([username])
  @@map("admins")
}
